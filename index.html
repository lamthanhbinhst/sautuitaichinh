 <!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>6 T√∫i T√†i Ch√≠nh</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f9fafb; margin: 0; }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useMemo, useEffect, useRef } = React;

        const JAR_CONFIG = [
            { id: 'NEC', name: 'Thi·∫øt y·∫øu', color: 'bg-blue-500', icon: 'üè†' },
            { id: 'FFA', name: 'T·ª± do t√†i ch√≠nh', color: 'bg-green-500', icon: 'üìà' },
            { id: 'LTS', name: 'Ti·∫øt ki·ªám', color: 'bg-purple-500', icon: 'üí∞' },
            { id: 'EDU', name: 'Gi√°o d·ª•c', color: 'bg-orange-500', icon: 'üéì' },
            { id: 'PLAY', name: 'H∆∞·ªüng th·ª•', color: 'bg-red-500', icon: 'üèñÔ∏è' },
            { id: 'GIVE', name: 'Cho ƒëi', color: 'bg-pink-500', icon: '‚ù§Ô∏è' },
        ];

        const PieChart = ({ data }) => {
            const chartRef = useRef(null);
            const chartInstance = useRef(null);
            useEffect(() => {
                if (chartInstance.current) chartInstance.current.destroy();
                const ctx = chartRef.current.getContext('2d');
                chartInstance.current = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: data.map(j => j.name),
                        datasets: [{
                            data: data.map(j => Math.max(0, j.amount)),
                            backgroundColor: ['#3b82f6', '#10b981', '#a855f7', '#f97316', '#ef4444', '#ec4899'],
                            borderWidth: 0
                        }]
                    },
                    options: { plugins: { legend: { display: false } }, cutout: '75%' }
                });
            }, [data]);
            return (
                <div className="relative w-44 h-44 mx-auto my-4">
                    <canvas ref={chartRef}></canvas>
                    <div className="absolute inset-0 flex flex-col items-center justify-center">
                        <span className="text-[10px] text-gray-400 uppercase font-bold tracking-widest">S·ªë d∆∞</span>
                        <span className="text-lg font-black text-gray-800 tracking-tighter">T·ªïng k·∫øt</span>
                    </div>
                </div>
            );
        };

        function App() {
            const [history, setHistory] = useState(() => {
                const saved = localStorage.getItem('financialData_v5');
                return saved ? JSON.parse(saved) : [{ 
                    month: new Date().toISOString().slice(0, 7), 
                    incomes: [], 
                    expenses: [],
                    ratios: { NEC: 55, FFA: 10, LTS: 10, EDU: 10, PLAY: 10, GIVE: 5 }
                }];
            });
            const [selectedMonth, setSelectedMonth] = useState(history[history.length - 1].month);
            const [isAddMonthOpen, setIsAddMonthOpen] = useState(false);
            const [isRatioEditOpen, setIsRatioEditOpen] = useState(false);
            const [tempRatios, setTempRatios] = useState({});

            useEffect(() => {
                localStorage.setItem('financialData_v5', JSON.stringify(history));
            }, [history]);

            const currentRecord = history.find(r => r.month === selectedMonth) || history[0];

            const summaryData = useMemo(() => {
                const res = {}; const cumul = {};
                const sortedHistory = [...history].sort((a, b) => a.month.localeCompare(b.month));
                
                sortedHistory.forEach(rec => {
                    const totalInc = rec.incomes.reduce((s, i) => s + i.amount, 0);
                    const ratios = rec.ratios || { NEC: 55, FFA: 10, LTS: 10, EDU: 10, PLAY: 10, GIVE: 5 };
                    
                    const jarStats = JAR_CONFIG.map(j => {
                        const perc = ratios[j.id] || 0;
                        const added = (totalInc * perc) / 100;
                        const spent = rec.expenses.filter(e => e.jarId === j.id).reduce((s, e) => s + e.amount, 0);
                        const opening = cumul[j.id] || 0;
                        cumul[j.id] = opening + added - spent;
                        return { ...j, opening, added, spent, closing: cumul[j.id] };
                    });
                    res[rec.month] = jarStats;
                });
                return res;
            }, [history]);

            const currentSummary = summaryData[selectedMonth] || [];

            const addTransaction = (type, jarId = null) => {
                const amount = prompt("Nh·∫≠p s·ªë ti·ªÅn (ƒë):");
                const desc = prompt("M√¥ t·∫£:");
                if (amount && !isNaN(amount) && desc) {
                    setHistory(old => old.map(r => r.month === selectedMonth ? {
                        ...r, [type === 'income' ? 'incomes' : 'expenses']: [...r[type === 'income' ? 'incomes' : 'expenses'], 
                        { id: Date.now().toString(), amount: parseInt(amount), description: desc, jarId }]
                    } : r));
                }
            };

            const formatMoney = (val) => new Intl.NumberFormat('vi-VN').format(val) + " ‚Ç´";

            return (
                <div className="max-w-md mx-auto min-h-screen bg-gray-50 pb-20">
                    <header className="p-4 bg-white shadow-sm flex justify-between items-center sticky top-0 z-40">
                        <h1 className="font-black text-xl text-gray-800 tracking-tighter italic">6 T√∫i <span className="text-blue-600">.</span></h1>
                        <div className="flex gap-2">
                             <button onClick={() => { setTempRatios(currentRecord.ratios); setIsRatioEditOpen(true); }} className="w-10 h-10 flex items-center justify-center bg-gray-100 rounded-xl">‚öôÔ∏è</button>
                             <button onClick={() => setIsAddMonthOpen(true)} className="bg-blue-600 text-white px-4 py-2 rounded-xl text-sm font-bold shadow-
